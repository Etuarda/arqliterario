
<div class="registration-box search-container">
  <h2 class="form-heading">Guardar uma nova leitura</h2>
  
  <div class="form-group">
    <label class="input-label">Qual livro andas a ler?</label>
    <input type="text" id="api-search-input" placeholder="Procurar pelo título no acervo mundial..." class="vintage-input">
    
    

<hr class="vintage-divider">


<%= form_with(model: book, id: "real-book-form") do |form| %>
  <% if book.errors.any? %>
    <div class="error-messages">
      <h2><%= pluralize(book.errors.count, "erro") %> impediram o salvamento:</h2>
      <ul>
        <% book.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="registration-box detail-box">
    <h3 class="form-subheading">Detalhes da Edição</h3>
    
    <div class="form-group">
      <%= form.label :title, "Título da obra", class: "input-label" %>
      <%= form.text_field :title, id: "field-title", class: "vintage-input-small" %>
    </div>

    <div class="form-group">
      <%= form.label :author, "Autor(a)", class: "input-label" %>
      <%= form.text_field :author, id: "field-author", class: "vintage-input-small" %>
    </div>

    <div class="form-row">
      <div class="form-group">
        <%= form.label :published_year, "Ano", class: "input-label" %>
        <%= form.number_field :published_year, id: "field-year", class: "vintage-input-small" %>
      </div>
      <div class="form-group">
        <%= form.label :status, class: "input-label" %>
        <%= form.select :status, Book.statuses.keys.map { |key| [key.humanize, key] }, {}, { class: "vintage-input-small" } %>
      </div>
    </div>

    <div class="form-group">
      <%= form.label :isbn, "ISBN", class: "input-label" %>
      <%= form.text_field :isbn, id: "field-isbn", class: "vintage-input-small" %>
    </div>

    <%= form.hidden_field :image_url, id: "field-image" %>

    <div class="form-actions">
      <%= form.submit "Confirmar e Guardar no Memorial", class: "btn-main" %>
    </div>
  </div>
<% end %>

<script>
  // O seu script de busca continua funcionando igual, agora chamando as classes e IDs limpos
  const searchInput = document.getElementById('api-search-input');
  const resultsList = document.getElementById('search-results-list');

  searchInput.addEventListener('input', async (e) => {
    const query = e.target.value;
    if (query.length < 3) {
      resultsList.style.display = 'none';
      return;
    }

    const response = await fetch(`/books/search?q=${encodeURIComponent(query)}`);
    const books = await response.json();

    resultsList.innerHTML = '';
    books.forEach(book => {
      const item = document.createElement('div');
      item.className = 'result-item';
      item.innerHTML = `<strong>${book.title}</strong> <br> <small>${book.author || 'Autor desconhecido'} (${book.published_year || 'N/A'})</small>`;
      
      item.onclick = () => {
        document.getElementById('field-title').value = book.title;
        document.getElementById('field-author').value = book.author || '';
        document.getElementById('field-year').value = book.published_year || '';
        document.getElementById('field-isbn').value = book.isbn || '';
        document.getElementById('field-image').value = book.image_url || '';
        
        resultsList.style.display = 'none';
        searchInput.value = '';
        searchInput.placeholder = "Livro selecionado: " + book.title;
      };
      resultsList.appendChild(item);
    });
    resultsList.style.display = 'block';
  });

  document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !resultsList.contains(e.target)) {
      resultsList.style.display = 'none';
    }
  });
</script>